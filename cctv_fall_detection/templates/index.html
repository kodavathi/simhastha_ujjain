<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CCTV Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f9; }
    h1 { text-align: center; }
    .feed { text-align: center; margin-bottom: 20px; }
    .feed img { border: 3px solid #333; border-radius: 8px; width: 640px; height: 480px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #eee; }
    img.snapshot { width: 120px; border: 2px solid #444; border-radius: 5px; }
    .note { font-size: 0.9em; color: #555; }
  </style>
  <script>
    // Auto-refresh the live feed every 500ms
    function refreshFeed() {
      const img = document.getElementById("live_feed");
      img.src = "/latest.jpg?t=" + new Date().getTime();
    }
    setInterval(refreshFeed, 500);

    // Auto-refresh the alerts table every 3s
    function refreshAlerts() {
      fetch("/alerts")
        .then(r => r.json())
        .then(data => {
          const tbody = document.getElementById("alerts_body");
          tbody.innerHTML = "";
          data.forEach(alert => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${alert.timestamp}</td>
              <td>${alert.person_id}</td>
              <td>${alert.bbox}</td>
              <td class="note">${alert.note}</td>
              <td>
                ${alert.snapshot ? `<a href="/snapshots/${alert.snapshot}" target="_blank"><img src="/snapshots/${alert.snapshot}" class="snapshot"></a>` : ""}
              </td>
            `;
            tbody.appendChild(tr);
          });
        });
    }
    setInterval(refreshAlerts, 3000);
    window.onload = function() {
      refreshFeed();
      refreshAlerts();
    };
  </script>
</head>
<body>
  <h1>ðŸ“¹ CCTV Monitoring Dashboard</h1>
  <div class="feed">
    <h2>Live Feed</h2>
    <img id="live_feed" src="/latest.jpg" alt="Live CCTV Feed">
  </div>

  <h2>ðŸš¨ Fall Alerts</h2>
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Person ID</th>
        <th>BBox</th>
        <th>Note</th>
        <th>Snapshot</th>
      </tr>
    </thead>
    <tbody id="alerts_body">
      <!-- Alerts will be dynamically loaded -->
    </tbody>
  </table>
</body>
</html>
